# 2021牛客多校四

## AC：6/10

[2021牛客暑期多校训练营4](https://ac.nowcoder.com/acm/contest/11255)

排名66/1291

----

_

---



E ：一次内存没开够，一次内存开太多


---


## H，Convolution


$$
x = \prod _i p_i^{a_i} , y = \prod_i p_i^{b_i} \\
x \otimes y = \prod _i p_i ^{|a_i - b_i|} \\
= \prod_i p_i^{a_i + b_i - min(a_i, b_i)} \\
= \frac{x \times y}{gcd(x, y)^2}\\
gcd(x, y) \rightarrow d, \frac{x}{d} \rightarrow x', \frac{y}{d} \rightarrow y' （x',y'互质）\\
b_i = \sum_{i \leq j, k \leq n, j \otimes k = i} a_jk^c \\
=\sum_{x'd \leq n, y'd \leq n, x'y'= i} a_{x'd}(y'd)^c \\
=y'^c(\sum_{x'd \leq n, y'd \leq n, x'y' = i}a_{x'd}d^c)\\
m = min(\frac{n}{x'} , \frac{n}{y'}) \\
F(x',y',m) =y'^c \sum_{d = 1}^{m} a_{x'd}d^c \\
预处理G（x', m）= \sum_{d = 1}^{m} a_{x'd}d^c
$$


```cpp
#include <bits/stdc++.h>

using namespace std;

typedef long long ll;

constexpr ll mod = 998244353;
constexpr ll N = 1e6 + 10;

ll a[N], b[N];
vector<vector<ll>> g(N);
ll fcc[N];

ll qpow(ll a, ll b, ll mod) {
    ll ans = 1;
    while (b) {
        if (b & 1) ans = (ans * a) % mod;
        a = (a * a) % mod;
        b >>= 1;
    }
    return ans;
}


ll primes[N], cnt = 0;
bool st[N];

inline void init() {
    cnt = 0;
    for (ll i = 2; i < N; ++i) {
        if (!st[i]) primes[++cnt] = i;
        for (ll j = 1; primes[j] * i < N; ++j) {
            st[primes[j] * i] = 1;
            if (i % primes[j] == 0) break;
        }
    }
}

vector<pair<ll, ll> > factor(ll x) {
    vector<pair<ll, ll> > res;
    for (ll i = 1; i <= cnt; ++i) {
        ll p = primes[i];
        if (p > x / p) break;
        if (x % p == 0) {
            ll tot = 0;
            while (x % p == 0) {
                tot++;
                x /= p;
            }
            res.push_back({p, tot});
        }
    }
    if (x != 1) res.push_back({x, 1});
    return res;
}

signed main() {
    ios::sync_with_stdio(false), cin.tie(nullptr), cout.tie(nullptr);

//    init();
//    fcc[0] = 0;

    ll n, c;
    cin >> n >> c;
    for (ll i = 1; i <= n; ++i) {
        cin >> a[i];
        fcc[i] = qpow(i, c, mod);
    }
    for (ll x = 1; x <= n; ++x) {
        g[x].push_back(0);
        for (ll m = 1; m <= n / x; ++m) {
            g[x].push_back((g[x][m - 1] + a[x * m] * fcc[m] % mod) % mod);
        }
    }
//    for (ll k = 1; k <= n; ++k) {
//        vector<pair<ll, ll> > vec = factor(k);
//        ll siz = vec.size();
//        for (ll i = 0; i < (1 << siz); ++i) {
//            ll xx = 1, yy = 1;
//            for (ll j = 0; j < siz; ++j) {
//                if ((i >> j) & 1) {
//                    xx = xx * qpow(vec[j].first, vec[j].second, mod) % mod;
//                } else {
//                    yy = yy * qpow(vec[j].first, vec[j].second, mod) % mod;
//                }
//            }
//            b[k] = (b[k] + qpow(yy, c, mod) * g[xx][min(n / xx, n / yy)] % mod) % mod;
//        }
//    }
    for (int i = 1; i <= n; ++i) {
        for (int j = 1; j <= n / i; ++j) {
            if (__gcd(i, j) != 1) continue;
            b[i * j] = (b[i * j] + fcc[j] * g[i][min(n / i, n / j)] % mod) % mod;
        }
    }

    ll ans = 0;
    for (ll i = 1; i <= n; ++i) {
        ans = ans ^ b[i];
    }
    cout << ans << endl;
    return 0;
}
```

阶层也预处理不然会T.. 枚举方式也有点问题

